[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:xpra]
command=xpra start :100 --use-display --bind-tcp=0.0.0.0:10005 --html=on --daemon=no --no-daemon --exit-with-children=no --notifications=no --no-pulseaudio --webcam=no --speaker=off --microphone=off
environment=DISPLAY=":100",HOME="/root",USER_ID="%(ENV_USER_ID)s"
autostart=true
autorestart=true
priority=30
stdout_logfile=/var/log/supervisor/xpra.log
stderr_logfile=/var/log/supervisor/xpra_err.log
startsecs=5

[program:x11vnc]
command=x11vnc -display :100 -rfbport 5900 -forever -noxdamage -shared -rfbauth /root/.vnc/passwd -geometry 1920x1080
directory=/opt
environment=DISPLAY=":100",HOME="/root"
autostart=true
autorestart=true
priority=35
stdout_logfile=/var/log/supervisor/x11vnc.log
stderr_logfile=/var/log/supervisor/x11vnc_err.log
startsecs=5

[program:window-controller]
command=python3 /opt/window_controller.py
directory=/opt
environment=DISPLAY=":100",HOME="/root"
autostart=false
autorestart=false
priority=40
stdout_logfile=/var/log/supervisor/window_controller.log
stderr_logfile=/var/log/supervisor/window_controller_err.log

[program:screen-agent]
command=/opt/run-screen-agent.sh
directory=/opt/screen-agent
environment=DISPLAY=":100",HOME="/root",PYTHONPATH="/opt:/opt/screen-agent"
autostart=false
autorestart=true
priority=50
stdout_logfile=/var/log/supervisor/screen_agent.log
stderr_logfile=/var/log/supervisor/screen_agent_err.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3
startsecs=10

[program:app-manager]
command=python3 /opt/app-launcher.py all
directory=/opt
environment=DISPLAY=":100",HOME="/root",PYTHONPATH="/opt"
autostart=true
autorestart=false
priority=60
stdout_logfile=/var/log/supervisor/app_manager.log
stderr_logfile=/var/log/supervisor/app_manager_err.log
startsecs=5
startretries=1

[program:agent-api]
command=/bin/bash /opt/start-agent-api.sh
directory=/opt
environment=DISPLAY=":100",HOME="/root",PYTHONPATH="/opt:/opt/screen-agent:/opt/lumina-search-flow-main",GEMINI_MIN_CALL_INTERVAL="6"
autostart=true
autorestart=true
priority=70
stdout_logfile=/var/log/supervisor/agent_api_stdout.log
stderr_logfile=/var/log/supervisor/agent_api_stderr.log
stdout_logfile_maxbytes=50MB
stderr_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile_backups=3
startsecs=10
startretries=999
